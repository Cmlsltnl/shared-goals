{% extends 'base.html' %}
{% load staticfiles %}
{% load markdown_deux_tags %}
{% load humanize %}
{% block content %}
  <div class="row small-gap-below">
    <div class="text-center">
      <h1>{{ request.goal.title }}</h1>
      <div class="button-grp">
        <button class="btn btn-default" onclick="location.href='{% url 'goal' request.goal.slug %}';">Top Proposals</button>
        <button class="btn btn-default">Members</button>
        {% if request.member %}
          <button class="btn btn-default" onclick="location.href='{% url 'profile' request.goal.slug %}';">My Profile</button>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="row small-gap-below">
    <div class="col-md-4"></div>
    <div class="col-md-4">
      <div class="proposal--photo" href="{% url 'proposal' request.goal.slug proposal.slug %}" style="background-image:url({{ proposal.image.url }});">
        <div class="proposal--gradient"></div>
        <h3 class="proposal--title">{{ revision.title }}</h3>
      </div>
    </div>
  </div>
  <div class="row small-gap-below">
    <div class="col-md-2"></div>
    <div class="col-md-8">
      <h5>Published by {{ proposal.owner.global_user.name }}, {{ proposal.pub_date|naturaltime }}</h5>{{ revision.description|markdown }}</div>
  </div>
  <div id="reviews"></div><script>
// proposal/load_reviews.js
sgreviews = function() {
    $('div.rateit, span.rateit').rateit();

    // load comments into each comment-block
    $(".comment-block").each(function(index, comment_block) {

        // load comments into this comment-block
        url_get_comment_block = $(comment_block).data("ajax-url");
        $(comment_block).load(url_get_comment_block, function() {

            // connect all reply-links within this comment-block
            var reply_links = $(comment_block).find(".comment-reply-link");
            reply_links.each(function(index, reply_link) {

                // connect this reply-link, so that it loads a form into reply-div
                $(reply_link).click(function() {

                    // load a reply form with ajax
                    url_get_comment_form = $(reply_link).data("ajax-url");
                    reply_div = $(reply_link).siblings(".comment-reply-div")[0];
                    $(reply_div).load(url_get_comment_form);
                });
           });
        });
    });
}

$(document).ready(function() {
    $("#reviews").load(
        "{% url 'reviews' request.goal.slug proposal.slug %}",
        sgreviews
    );
});
</script>{% endblock %}
